{\rtf1\ansi\ansicpg1252\cocoartf1671\cocoasubrtf600
{\fonttbl\f0\fswiss\fcharset0 Helvetica;\f1\fswiss\fcharset0 ArialMT;\f2\fnil\fcharset0 Menlo-Regular;
}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red255\green255\blue255;\red0\green0\blue0;
\red255\green255\blue255;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c100000\c100000\c100000;\csgray\c0;
\csgray\c100000;}
\margl1440\margr1440\vieww11680\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 ANALYZE CRISPR KO SCREEN DATA\
\
\
\pard\pardeftab720\sl340\partightenfactor0

\f1\fs22 \cf2 \cb3 \expnd0\expndtw0\kerning0
Build bowtie2 index for CRISPR KO barcodes\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardeftab720\pardirnatural\partightenfactor0
\cf4 \cb5 \kerning1\expnd0\expndtw0 \CocoaLigature0 bowtie2-build ~/Documents/MPRA/\cf0 \cb1 \CocoaLigature1 Cancer_MPRA_Scaleup/CRISPR_KO_Screen/BowtieIndex/colon_crispr_ko_index.fa\cf4 \cb5 \CocoaLigature0  colon_crispr_ko_index\
\pard\pardeftab720\sl340\partightenfactor0
\cf2 \cb3 \expnd0\expndtw0\kerning0
\CocoaLigature1 \
Sequencing library layout:\
UMI is in first 9bp\
Guide is 31-50bp\
\
# 0. Unzip file\
gunzip  
\f2 \cf4 \cb1 \kerning1\expnd0\expndtw0 \CocoaLigature0 1_S1_L001_R1_001.fastq.gz \

\f1 \cf2 \cb3 \expnd0\expndtw0\kerning0
\CocoaLigature1 \
# 1.  Extract the UMI\
umi_tools extract --bc-pattern=NNNNNNNNN --stdin=
\f2 \cf4 \cb1 \kerning1\expnd0\expndtw0 \CocoaLigature0 1_S1_L001_R1_001.fastq
\f1 \cf2 \cb3 \expnd0\expndtw0\kerning0
\CocoaLigature1  --stdout=1_umi_extracted.fastq \
\
# 2. Trim to just the guide - now bases 22 through 41\
fastx_trimmer -f 22 -l 41 -Q33 -i 1_umi_extracted.fastq -o 1_umi_trimmed.fastq -v\
\
# 3. Align to bowtie index \
bowtie2 -p 8 -k 1 --norc -x /Users/laurakellman/Documents/MPRA/Cancer_MPRA_Scaleup/CRISPR_KO_Screen/BowtieIndex/\cf4 \cb5 \kerning1\expnd0\expndtw0 \CocoaLigature0 colon_crispr_ko_index \cf2 \cb3 \expnd0\expndtw0\kerning0
\CocoaLigature1 1_umi_trimmed.fastq -S 1-aligned.sam --no-unal\
\
# 4. Convert sam to bam \
samtools view -S -b 1-aligned.sam > 1-aligned.bam\
\
# 5. Sort the bam\
samtools sort 1-aligned.bam -o 1-aligned-sorted.bam\
\
# 6. Index the bam\
samtools index 1-aligned-sorted.bam\
\
# 7. Deduplicate based on UMIs \
umi_tools dedup -I 1-aligned-sorted.bam -L logfile_1.txt --out-sam --no-sort-output -S 1_dedup.sam\
\
# 8. Convert sam to tsv\
awk '$1 !~ /^@/ \{print $1"\\t"$3\}' 1_dedup.sam > 1_reformat.tsv\
\
# 9. Count unique reads for each barcode\
umi_tools count_tab -I 1_reformat.tsv -S 1_counts.tsv -L 1_count.log\
\
}